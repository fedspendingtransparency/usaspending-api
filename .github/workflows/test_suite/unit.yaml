name: Unit Tests

on:
  workflow_call:

jobs:
  Run-Non-Spark-Integration-Tests:
    name: Run Unit Tests
    runs-on: ${{ vars.RUNNER_VERSION }}
    steps:
      - name: Checkout source repository
        uses: actions/checkout@v4

      - name: Init Test Environment
        uses: ./.github/actions/init-test-environment
        with:
          create_test_db: false
          preload_spark_jars: false

      - name: Run integration test cases
        run: >
          pytest --reuse-db --numprocesses logical --cov=usaspending_api --cov-report term -r=fEs --dist worksteal --verbosity=1 --durations 50
          --override-ini=python_files="test_*.py *_test.py" --ignore-glob="**/tests/integration/*"
